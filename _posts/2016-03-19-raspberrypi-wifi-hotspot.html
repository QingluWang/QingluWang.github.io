---
layout: post
status: publish
published: true
title: RaspberryPi制作无线路由器
author:
  display_name: Garlic
  login: wangqinglu
  email: 1119543546@qq.com
  url: ''
author_login: wangqinglu
author_email: 1119543546@qq.com
wordpress_id: 70
wordpress_url: http://wql970522.vicp.net/?p=70
date: '2016-03-19 19:45:13 +0800'
date_gmt: '2016-03-19 11:45:13 +0800'
categories:
- "服务器"
tags: []
comments: []
---
<p>用Xshell登录树莓派raspbian系统，制作无线路由器</p>
<p>原料：树莓派+USB无线网卡+网线</p>
<p>一、配置网络环境：</p>
<p>1、准备工作</p>
<p>用一条网线联通树莓派和电脑，电脑连接可上网的无线，开启共享，之后在cmd里输入arp &ndash;a,找到一个与本机同网段的IP，例如192.168.137.22,设置电脑以太网固定IP跟它是同一网段，比如设为192.168.137.66，用Xshell访问192.168.137.22，输入树莓派给的用户名和密码，进入raspbian.</p>
<p>2、安装hotspot(hostapd)</p>
<p>sudo apt-get install bridge-utils hostapd</p>
<p>3、安装udhcp</p>
<p>sudo apt-get install udhcpd</p>
<p>这玩意主要是用来为连接到热点的设备分配IP地址的，遵从DHCP协议</p>
<p>4、配置udhcpd.conf文件</p>
<p>sudo nano /etc/udhcpd.conf</p>
<p>wifi热点分配的ip地址范围，start-->end</p>
<p>&nbsp;</p>
<p>udhcp服务的接口，设为wlan0网卡接口</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>配置dns&mdash;opt dns、子网掩码&mdash;opt subnet、路由地址&mdash;opt router 十天内DHCP以秒为单位的租约时间&mdash;opt lease 86400</p>
<p>&nbsp;</p>
<p>5、配置无线网卡部分信息</p>
<p>sudo nano&nbsp; /etc/network/interfaces</p>
<p>我这里是只允许了一个无线网卡wlan0热插拔，即allow-hotplug&nbsp; wlan0然后把无线网卡的IP地址设为静态且固定的</p>
<p>&nbsp;</p>
<p>6、配置hostapd.conf文件</p>
<p>sudo nano /etc/hostapd/hostapd.conf</p>
<p>ssid--wifi热点名称</p>
<p>wpa_passphrasse--wifi热点密码</p>
<p>channel--一般3 9 11信号比较好。。</p>
<p>&nbsp;</p>
<p>7、开通NAT</p>
<p>sudo sh &ndash;c &ldquo;echo 1 > /proc/sys/net/ipv4/ip_forward&rdquo;</p>
<p>编辑/etc/sysctl.conf</p>
<p>改动此行为net.ipv4.ip_forward=1</p>
<p>8、配置iptables防火墙</p>
<p>sudo iptables &ndash;t nat &ndash;A POSTROUTING &ndash;o eth0 &ndash;j MASQUERADE</p>
<p>sudo iptables &ndash;A FORWARD &ndash;i eth0 &ndash;o wlan0 &ndash;m state &ndash;state RELATED,ESTABLISHED &ndash;j ACCEPT</p>
<p>sudo iptables &ndash;A FORWARD &ndash;i wlan0 &ndash;o eth0 &ndash;j ACCEPT</p>
<p>将刚才配置的iptables保存下来以便下次使用</p>
<p>sudo sh &ndash;c &ldquo;iptables-save > /etc/iptables.ipv4.nat&rdquo;</p>
<p>sudo nano /etc/network/interfaces</p>
<p>在最后加上</p>
<p>up iptables-restore < /etc/iptables.ipv4.nat</p>
<p>9、重启并测试</p>
<p>sudo reboot</p>
<p>测试</p>
<p>sudo hostapd &ndash;dd /etc/hostapd/hostapd.conf</p>
<p>若无错误，则能搜到你自己配的无线信号了</p>
<p>Ctrl+C退出测试</p>
<p>10、设置hostapd的配置文件路径</p>
<p>sudo nano /etc/default/hostapd</p>
<p>去掉注释符号并改动下面这行，为我们的配置文件路径</p>
<p>DAEMON_CONF=&rdquo;/etc/hostapd/hostapd.conf&rdquo;</p>
<p>11、启动相应软件和加入启动项</p>
<p>sudo service hostapd start</p>
<p>sudo service udhcpd start</p>
<p>sudo update-rc.d hostapd enable</p>
<p>sudo update-rc.d udhcpd enable</p>
<p>PS:</p>
<p>若无线网卡配置的DHCP不能发挥作用，ifconfig &ndash;a 后，发现wlan0的ip地址并不是我们指定的静态IP地址</p>
<p>解决办法：</p>
<p>sudo nano /etc/default/ifplugd</p>
<p>加入如下内容</p>
<p>INTERFACES="eth0" HOTPLUG_INTERFACES="eth0" ARGS="-q -f -u0 -d10 -w -I" SUSPEND_ACTION="stop"</p>
<p>&nbsp;</p>
<p>尊重原作：<a title="http://wangye.org/blog/archives/845/" href="http://wangye.org/blog/archives/845/">http://wangye.org/blog/archives/845/</a></p>
